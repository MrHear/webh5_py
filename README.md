# OneSpace åšå®¢ç³»ç»Ÿåç«¯ API

ä¸€ä¸ªå®‰å…¨å¯é çš„ä¸ªäººåšå®¢åç«¯APIç³»ç»Ÿï¼ŒåŸºäº FastAPI æ„å»ºã€‚

## ğŸ›¡ï¸ å®‰å…¨ç‰¹æ€§

### 1. èº«ä»½è®¤è¯ä¸æˆæƒ
- **JWT Tokenè®¤è¯**ï¼šä½¿ç”¨ HS256 ç®—æ³•ç­¾åçš„ JWT ä»¤ç‰Œ
- **bcryptå¯†ç å“ˆå¸Œ**ï¼šå®‰å…¨çš„å¯†ç å­˜å‚¨æ–¹æ¡ˆ
- **è§’è‰²æƒé™æ§åˆ¶**ï¼šç®¡ç†å‘˜ä¸“å±æ“ä½œæƒé™

### 2. è¾“å…¥éªŒè¯ä¸è¿‡æ»¤
- **XSSé˜²æŠ¤**ï¼šä½¿ç”¨ bleach åº“è¿‡æ»¤æ¶æ„è„šæœ¬
- **SQLæ³¨å…¥æ£€æµ‹**ï¼šè¯·æ±‚å‚æ•°å®æ—¶æ‰«æ
- **æ–‡ä»¶ç±»å‹éªŒè¯**ï¼šé€šè¿‡é­”æ•°æ£€æµ‹çœŸå®æ–‡ä»¶ç±»å‹
- **å†…å®¹é•¿åº¦é™åˆ¶**ï¼šé˜²æ­¢è¶…å¤§å†…å®¹æ”»å‡»

### 3. é€Ÿç‡é™åˆ¶
- **APIé™æµ**ï¼šæ¯åˆ†é’Ÿè¯·æ±‚æ¬¡æ•°é™åˆ¶
- **ç™»å½•ä¿æŠ¤**ï¼šç™»å½•æ¥å£ä¸¥æ ¼é™æµï¼ˆ5æ¬¡/åˆ†é’Ÿï¼‰
- **ä¸Šä¼ é™åˆ¶**ï¼šæ–‡ä»¶ä¸Šä¼ æ¥å£å•ç‹¬é™æµ

### 4. è¯·æ±‚å®‰å…¨
- **å®‰å…¨å“åº”å¤´**ï¼šX-Content-Type-Options, X-Frame-Options, X-XSS-Protection
- **CORSé…ç½®**ï¼šç™½åå•åŸŸåè®¿é—®æ§åˆ¶
- **è·¯å¾„éå†é˜²æŠ¤**ï¼šé˜»æ­¢ `../` ç­‰æ¶æ„è·¯å¾„
- **æ”»å‡»æ‰«ææ£€æµ‹**ï¼šè¯†åˆ«å¸¸è§æ‰«æå™¨å’Œæ”»å‡»æ¨¡å¼

### 5. æ•°æ®å®‰å…¨
- **è½¯åˆ é™¤**ï¼šæ•°æ®ä¸ä¼šçœŸæ­£åˆ é™¤ï¼Œä¾¿äºæ¢å¤
- **UUIDä¸»é”®**ï¼šä¸æš´éœ²è‡ªå¢IDï¼Œé˜²æ­¢æšä¸¾æ”»å‡»
- **æ—¥å¿—å®¡è®¡**ï¼šå®Œæ•´çš„æ“ä½œæ—¥å¿—è®°å½•

## ğŸ“¦ æŠ€æœ¯æ ˆ

- **æ¡†æ¶**: FastAPI 0.109.2
- **æ•°æ®åº“**: MySQL + SQLAlchemy (å¼‚æ­¥)
- **è®¤è¯**: JWT (python-jose)
- **é™æµ**: slowapi
- **æ—¥å¿—**: loguru

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

å¤åˆ¶ `.env.example` ä¸º `.env` å¹¶ä¿®æ”¹é…ç½®ï¼š

```bash
# æ•°æ®åº“é…ç½®
DB_HOST=localhost
DB_PORT=3306
DB_USER=root
DB_PASSWORD=your_password
DB_NAME=onespace

# JWTé…ç½®
JWT_SECRET_KEY=your-super-secret-key

# ç®¡ç†å‘˜é…ç½®
ADMIN_USERNAME=admin
ADMIN_PASSWORD_HASH=xxx  # ä½¿ç”¨è„šæœ¬ç”Ÿæˆ
```

### 3. ç”Ÿæˆç®¡ç†å‘˜å¯†ç å“ˆå¸Œ

```bash
python scripts/generate_password_hash.py your_password
```

å°†è¾“å‡ºçš„å“ˆå¸Œå€¼å¤åˆ¶åˆ° `.env` æ–‡ä»¶çš„ `ADMIN_PASSWORD_HASH` ä¸­ã€‚

### 4. åˆå§‹åŒ–æµ‹è¯•æ•°æ®ï¼ˆå¯é€‰ï¼‰

```bash
python scripts/init_test_data.py
```

### 5. å¯åŠ¨æœåŠ¡

```bash
python run.py
```

æˆ–ä½¿ç”¨ uvicorn ç›´æ¥å¯åŠ¨ï¼š

```bash
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

## ğŸ“š API æ–‡æ¡£

å¼€å‘æ¨¡å¼ä¸‹è®¿é—®ï¼š
- Swagger UI: http://localhost:8000/docs
- ReDoc: http://localhost:8000/redoc

> âš ï¸ ç”Ÿäº§ç¯å¢ƒä¸‹APIæ–‡æ¡£ä¼šè‡ªåŠ¨ç¦ç”¨

## ğŸ”Œ API æ¥å£

### å…¬å¼€æ¥å£

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| GET | `/api/v1/posts` | è·å–æ–‡ç« åˆ—è¡¨ |
| GET | `/api/v1/posts/{id}` | è·å–æ–‡ç« è¯¦æƒ… |
| GET | `/health` | å¥åº·æ£€æŸ¥ |

### ç®¡ç†å‘˜æ¥å£ï¼ˆéœ€è¦Tokenï¼‰

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| POST | `/api/v1/auth/login` | ç®¡ç†å‘˜ç™»å½• |
| POST | `/api/v1/posts` | åˆ›å»ºæ–‡ç«  |
| PUT | `/api/v1/posts/{id}` | æ›´æ–°æ–‡ç«  |
| DELETE | `/api/v1/posts/{id}` | åˆ é™¤æ–‡ç«  |
| POST | `/api/v1/upload` | ä¸Šä¼ å›¾ç‰‡ |

## ğŸ“‚ é¡¹ç›®ç»“æ„

```
webh5_py/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py          # åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ config.py        # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ database.py      # æ•°æ®åº“è¿æ¥
â”‚   â”œâ”€â”€ models.py        # ORMæ¨¡å‹
â”‚   â”œâ”€â”€ schemas.py       # Pydanticæ¨¡å¼
â”‚   â”œâ”€â”€ security.py      # å®‰å…¨æ¨¡å—
â”‚   â”œâ”€â”€ middleware.py    # ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ rate_limiter.py  # é€Ÿç‡é™åˆ¶
â”‚   â””â”€â”€ routes/
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ posts.py     # æ–‡ç« è·¯ç”±
â”‚       â”œâ”€â”€ auth.py      # è®¤è¯è·¯ç”±
â”‚       â””â”€â”€ upload.py    # ä¸Šä¼ è·¯ç”±
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ generate_password_hash.py  # å¯†ç å“ˆå¸Œç”Ÿæˆ
â”‚   â””â”€â”€ init_test_data.py          # æµ‹è¯•æ•°æ®åˆå§‹åŒ–
â”œâ”€â”€ logs/                # æ—¥å¿—ç›®å½•
â”œâ”€â”€ uploads/             # ä¸Šä¼ æ–‡ä»¶ç›®å½•
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ run.py
â””â”€â”€ README.md
```

## ğŸ”’ ç”Ÿäº§ç¯å¢ƒå»ºè®®

1. **ä½¿ç”¨ HTTPS**ï¼šé…ç½® SSL è¯ä¹¦
2. **ä½¿ç”¨ Redis**ï¼šå°†é€Ÿç‡é™åˆ¶å­˜å‚¨æ”¹ä¸º Redis
3. **é…ç½®åå‘ä»£ç†**ï¼šNginx + Gunicorn
4. **å®šæœŸå¤‡ä»½æ•°æ®åº“**
5. **ç›‘æ§æ—¥å¿—**ï¼šé…ç½®æ—¥å¿—å‘Šè­¦
6. **æ›´æ–°ä¾èµ–**ï¼šå®šæœŸæ›´æ–°å®‰å…¨è¡¥ä¸

## ğŸ“„ License

MIT License
